<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dragon's Ledger UI Kit</title>
  <link rel="stylesheet" href="tokens.css" />
  <link rel="stylesheet" href="theme.css" />
  <link rel="stylesheet" href="motion.css" />
  <link rel="stylesheet" href="components/AppShell.css" />
  <link rel="stylesheet" href="components/Button.css" />
  <link rel="stylesheet" href="components/InputPack.css" />
  <link rel="stylesheet" href="components/CardPanel.css" />
  <link rel="stylesheet" href="components/Tabs.css" />
  <link rel="stylesheet" href="components/Accordion.css" />
  <link rel="stylesheet" href="components/Toast.css" />
  <link rel="stylesheet" href="components/Modal.css" />
  <link rel="stylesheet" href="components/DialogueChoice.css" />
  <link rel="stylesheet" href="components/QuestTracker.css" />
  <link rel="stylesheet" href="components/CharacterSheet.css" />
  <link rel="stylesheet" href="components/CombatHUD.css" />
  <link rel="stylesheet" href="components/MinimapBanner.css" />
  <link rel="stylesheet" href="components/Achievement.css" />
  <link rel="stylesheet" href="components/MenuSystem.css" />
  <style>
    body {
      display: grid;
      gap: var(--space-2xl);
      padding: var(--space-2xl);
    }
    header.hero {
      position: relative;
      display: grid;
      gap: var(--space-lg);
      padding: var(--space-3xl);
      border-radius: var(--radius-lg);
      background-image: var(--hero-background);
      background-size: cover, 360px 360px;
      background-blend-mode: lighten;
      overflow: hidden;
      box-shadow: var(--shadow-high);
    }
    header.hero::after {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at top, rgba(200,162,74,0.18), transparent 70%);
      pointer-events: none;
    }
    header.hero h1 {
      font-size: clamp(2.5rem, 6vw, 4rem);
      margin: 0;
    }
    .layout {
      display: grid;
      gap: var(--space-2xl);
    }
    .grid-columns {
      display: grid;
      gap: var(--space-2xl);
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
    }
    .background-preview {
      display: grid;
      gap: var(--space-md);
    }
    .background-preview__hero,
    .background-preview__layer {
      border-radius: var(--radius-md);
      border: var(--border-hairline);
      min-height: 220px;
      background-size: cover, 360px 360px;
      box-shadow: var(--shadow-low);
      transition: background-image 180ms ease;
    }
    .background-preview__hero {
      min-height: 300px;
      background-image: var(--hero-background);
    }
    .background-preview__layer {
      background-image: var(--page-tile, var(--texture-parchment));
    }
    .theme-toggle {
      display: inline-flex;
      gap: var(--space-sm);
      align-items: center;
    }
    .audio-controls {
      display: flex;
      gap: var(--space-md);
      flex-wrap: wrap;
      align-items: center;
    }
    footer.page-footer {
      text-align: center;
      padding: var(--space-xl) 0;
      color: var(--color-muted);
    }
    section h2 {
      margin-top: 0;
    }
    .component-frame {
      display: grid;
      gap: var(--space-md);
    }
    .component-frame article {
      padding: var(--space-lg);
      border-radius: var(--radius-lg);
      border: var(--border-hairline);
      background: color-mix(in srgb, var(--color-surface-0), rgba(255,255,255,0.04));
      box-shadow: var(--shadow-low);
    }
    .background-selector {
      display: flex;
      gap: var(--space-sm);
      flex-wrap: wrap;
    }
    .background-selector button {
      padding: 6px 12px;
      border-radius: var(--radius-pill);
      border: var(--border-hairline);
      background: color-mix(in srgb, var(--color-surface-1), rgba(255,255,255,0.08));
      color: var(--color-primary-contrast);
      cursor: pointer;
    }
    .background-selector button[aria-pressed="true"] {
      background: color-mix(in srgb, var(--color-accent), rgba(0,0,0,0.3));
      color: var(--color-bg);
      box-shadow: var(--shadow-low);
    }
    .background-selector button:focus-visible {
      outline: 2px solid var(--color-info);
      outline-offset: 2px;
    }
  </style>
</head>
<body>
  <header class="hero">
    <h1>Dragon's Ledger UI Kit</h1>
    <p>Premium D&D-inspired interface assets, animations, audio, and scaffolding for your solo RPG.</p>
    <div class="theme-toggle" role="group" aria-label="Theme selector">
      <button class="btn btn-subtle" data-theme-set="dark">Dark</button>
      <button class="btn btn-subtle" data-theme-set="parchment">Parchment</button>
      <button class="btn btn-subtle" data-theme-set="contrast">High Contrast</button>
      <button class="btn btn-subtle" data-reduced-motion>Toggle Motion</button>
    </div>
    <div class="audio-controls" aria-label="Audio controls">
      <button class="btn btn-subtle" data-audio-toggle>Mute Audio</button>
      <label>Volume <input type="range" min="0" max="1" step="0.05" value="0.7" data-audio-volume /></label>
    </div>
  </header>

  <main class="layout">
    <section>
      <h2>Navigation &amp; Menus</h2>
      <div class="component-frame">
        <article>
          <section class="menu-system" data-component="menu-system">
            <div class="menu-system__title" role="banner">
              <h1>Dragon's Ledger</h1>
              <p>Solo Adventures Await</p>
            </div>
            <div class="menu-system__background" role="img" aria-label="Forest glade backdrop"></div>
            <nav class="menu-system__main" aria-label="Main menu">
              <ul>
                <li><button class="menu-item" data-action="continue">Continue</button></li>
                <li><button class="menu-item" data-action="new">New Game</button></li>
                <li><button class="menu-item" data-action="options" data-modal-open="options">Options</button></li>
                <li><button class="menu-item" data-action="codex">Codex</button></li>
                <li><button class="menu-item" data-action="quit">Quit</button></li>
              </ul>
            </nav>
            <div class="menu-system__footer">
              <button class="btn btn-ghost" data-command-palette>Command Palette (Ctrl+P)</button>
            </div>
            <div class="command-palette" role="dialog" aria-modal="true" aria-label="Command palette" hidden>
              <input type="text" placeholder="Search actions" aria-label="Command search" />
              <ul role="listbox" aria-label="Quick actions">
                <li role="option">Open Character Sheet</li>
                <li role="option">Jump to Journal</li>
                <li role="option">Toggle High Contrast</li>
              </ul>
            </div>
          </section>
        </article>
        <article>
          <section class="app-shell" aria-label="App layout shell">
            <header class="app-shell__header" role="banner">
              <div class="logo" aria-label="Dragon's Ledger">
                <span class="logo__mark" aria-hidden="true">âš”</span>
                <span class="logo__text">Dragon's Ledger</span>
              </div>
              <button class="btn btn-ghost app-shell__menu-toggle" aria-controls="primary-nav" aria-expanded="false">Menu</button>
            </header>
            <nav class="app-shell__nav" id="primary-nav" aria-label="Primary">
              <ul>
                <li><a class="nav-link" href="#" aria-current="page">Dashboard</a></li>
                <li><a class="nav-link" href="#character">Character</a></li>
                <li><a class="nav-link" href="#quests">Quests</a></li>
                <li><a class="nav-link" href="#codex">Codex</a></li>
                <li><a class="nav-link" href="#map">Map</a></li>
              </ul>
            </nav>
            <main class="app-shell__content" role="main">
              <p>Place application content here.</p>
            </main>
            <footer class="app-shell__footer" role="contentinfo">
              <small>Â© 1492 DR Dragon's Ledger. All rights reserved.</small>
            </footer>
          </section>
        </article>
      </div>
    </section>

    <section>
      <h2>Inputs &amp; Content</h2>
      <div class="grid-columns">
        <article>
          <div class="button-demo" role="group" aria-label="Button showcase">
            <button class="btn" data-sound="click">Primary Action</button>
            <button class="btn btn-ghost">Ghost Action</button>
            <button class="btn btn-danger" data-sound="error">Danger</button>
            <button class="btn btn-subtle">Subtle</button>
          </div>
        </article>
        <article>
          <form class="input-pack" aria-label="Character creation form">
            <label>
              <span>Adventurer Name</span>
              <input type="text" name="name" placeholder="Lady Mira" required />
            </label>
            <label>
              <span>Level</span>
              <input type="number" name="level" min="1" value="5" />
            </label>
            <label>
              <span>Class</span>
              <select name="class">
                <option>Paladin</option>
                <option>Ranger</option>
                <option>Wizard</option>
                <option>Bard</option>
              </select>
            </label>
            <fieldset>
              <legend>Favors</legend>
              <label class="check"><input type="checkbox" name="favor" value="guild" checked /> Guild Patronage</label>
              <label class="check"><input type="checkbox" name="favor" value="spirits" /> Spirits' Blessing</label>
            </fieldset>
            <fieldset>
              <legend>Alignment</legend>
              <label class="radio"><input type="radio" name="alignment" value="lawful" checked /> Lawful Good</label>
              <label class="radio"><input type="radio" name="alignment" value="neutral" /> True Neutral</label>
            </fieldset>
            <label>
              <span>Resolve</span>
              <input type="range" name="resolve" min="0" max="100" value="72" />
            </label>
            <div class="segmented" role="radiogroup" aria-label="Stance">
              <button type="button" class="segmented__option is-selected" data-value="attack">Attack</button>
              <button type="button" class="segmented__option" data-value="defend">Defend</button>
              <button type="button" class="segmented__option" data-value="support">Support</button>
            </div>
          </form>
        </article>
        <article>
          <section class="tabs" data-component="tabs" aria-label="Options tabs">
            <div role="tablist" aria-label="Codex tabs">
              <button role="tab" id="tab-lore" aria-controls="panel-lore" aria-selected="true" tabindex="0">Lore</button>
              <button role="tab" id="tab-factions" aria-controls="panel-factions" aria-selected="false" tabindex="-1">Factions</button>
              <button role="tab" id="tab-artifacts" aria-controls="panel-artifacts" aria-selected="false" tabindex="-1">Artifacts</button>
            </div>
            <article role="tabpanel" id="panel-lore" aria-labelledby="tab-lore">
              <p>The realm of Halcyon is bound by ancient accords with the Ember Court.</p>
            </article>
            <article role="tabpanel" id="panel-factions" aria-labelledby="tab-factions" hidden>
              <ul>
                <li>Crownwatch Vanguard</li>
                <li>Umbral Cabal</li>
              </ul>
            </article>
            <article role="tabpanel" id="panel-artifacts" aria-labelledby="tab-artifacts" hidden>
              <p>Echo Lantern, Phoenix Sigil, Whisper Chain.</p>
            </article>
          </section>
        </article>
        <article>
          <section class="accordion" data-component="accordion" aria-label="Lore entries">
            <h2 class="sr-only">Lore entries</h2>
            <button class="accordion__trigger" aria-expanded="false" aria-controls="lore-1" id="accordion-1">The Ember Accord</button>
            <div class="accordion__panel" id="lore-1" role="region" aria-labelledby="accordion-1">
              <p>An oath sworn between dragons and mortals to end the Skyfall War.</p>
            </div>
            <button class="accordion__trigger" aria-expanded="false" aria-controls="lore-2" id="accordion-2">Runes of Kel</button>
            <div class="accordion__panel" id="lore-2" role="region" aria-labelledby="accordion-2">
              <p>Sigils etched in obsidian; they hum softly when danger nears.</p>
            </div>
          </section>
        </article>
        <article>
          <section class="panel card-panel" aria-label="Lore codex">
            <header class="card-panel__header">
              <h2>Expedition Briefing</h2>
              <div class="card-panel__tools" role="toolbar">
                <button class="btn btn-ghost" aria-label="Pin briefing"><span aria-hidden="true">ðŸ“Œ</span></button>
                <button class="btn btn-ghost" aria-label="Share briefing"><span aria-hidden="true">âœ‰</span></button>
              </div>
            </header>
            <article class="card">
              <h3>Ruins of Mael'Thor</h3>
              <p>A shattered keep clinging to the storm cliffs. Rumors speak of a vault beneath, sealed with dragon sigils.</p>
              <ul class="card-panel__meta">
                <li class="tag badge-gold">Difficulty: Hard</li>
                <li class="tag">Region: Tempest Coast</li>
              </ul>
            </article>
          </section>
        </article>
      </div>
    </section>

    <section>
      <h2>HUD &amp; Gameplay</h2>
      <div class="grid-columns">
        <article>
          <section class="quest-tracker" aria-label="Quest tracker">
            <header class="quest-tracker__header">
              <h2>Active Quests</h2>
              <span class="tag badge-gold">3 Active</span>
            </header>
            <ol class="quest-tracker__list">
              <li>
                <div>
                  <strong>Echoes in the Vault</strong>
                  <p>Locate the resonant crystals beneath Mael'Thor.</p>
                </div>
                <span class="quest-tracker__status" data-state="progress">In Progress</span>
              </li>
              <li>
                <div>
                  <strong>Cartographer's Debt</strong>
                  <p>Deliver the sky map to the Crownwatch.</p>
                </div>
                <span class="quest-tracker__status" data-state="ready">Ready to Turn In</span>
              </li>
              <li>
                <div>
                  <strong>Shadows in the Fen</strong>
                  <p>Investigate Umbral activity in the Verdant Mire.</p>
                </div>
                <span class="quest-tracker__status" data-state="new">New</span>
              </li>
            </ol>
          </section>
        </article>
        <article>
          <section class="character-sheet" aria-label="Character sheet">
            <header class="character-sheet__header">
              <h2>Lady Mira Valen</h2>
              <span class="tag">Level 12 Paladin</span>
            </header>
            <div class="character-sheet__grid">
              <section>
                <h3>Ability Scores</h3>
                <dl class="stats">
                  <div><dt>STR</dt><dd>18</dd></div>
                  <div><dt>DEX</dt><dd>12</dd></div>
                  <div><dt>CON</dt><dd>16</dd></div>
                  <div><dt>INT</dt><dd>11</dd></div>
                  <div><dt>WIS</dt><dd>14</dd></div>
                  <div><dt>CHA</dt><dd>20</dd></div>
                </dl>
              </section>
              <section>
                <h3>Skills</h3>
                <ul class="skills">
                  <li>Persuasion +12</li>
                  <li>Athletics +8</li>
                  <li>Insight +9</li>
                  <li>Religion +7</li>
                </ul>
              </section>
              <section>
                <h3>Inventory</h3>
                <ul class="inventory">
                  <li><span>Sunblade</span><span>Equipped</span></li>
                  <li><span>Dragonbone Shield</span><span>Equipped</span></li>
                  <li><span>Vials of Radiant Draught</span><span>3</span></li>
                </ul>
              </section>
              <section>
                <h3>Factions</h3>
                <ul class="factions">
                  <li>Crownwatch Vanguard â–¸ Exalted</li>
                  <li>Umbral Cabal â–¸ Wary</li>
                </ul>
                <h3>Conditions</h3>
                <ul class="conditions">
                  <li>Inspired</li>
                  <li>Sanctified</li>
                </ul>
              </section>
            </div>
          </section>
        </article>
        <article>
          <section class="combat-hud" aria-label="Combat heads-up display">
            <div class="combat-hud__turn-order" aria-label="Turn order" role="list">
              <div role="listitem" class="combat-hud__turn is-active">Mira</div>
              <div role="listitem" class="combat-hud__turn">Sable Warden</div>
              <div role="listitem" class="combat-hud__turn">Runecaller</div>
            </div>
            <div class="combat-hud__action-bar" role="group" aria-label="Action bar">
              <button class="btn" data-sound="click">Smite</button>
              <button class="btn btn-ghost">Guard</button>
              <button class="btn btn-ghost">Channel</button>
              <button class="btn btn-danger">Retreat</button>
            </div>
            <div class="combat-hud__enemy">
              <div class="combat-hud__enemy-name">Sable Warden</div>
              <div class="combat-hud__enemy-health" role="progressbar" aria-valuenow="68" aria-valuemin="0" aria-valuemax="100">
                <span style="width:68%"></span>
              </div>
            </div>
            <div class="combat-hud__floaters" aria-live="assertive"></div>
          </section>
        </article>
        <article>
          <section class="minimap" aria-label="Area banner">
            <header>
              <h2>Tempest Coast</h2>
              <span class="tag">Stormwatch Keep</span>
            </header>
            <div class="minimap__view" role="img" aria-label="Stylized map of the Tempest Coast">
              <canvas width="240" height="180"></canvas>
            </div>
          </section>
        </article>
      </div>
    </section>

    <section>
      <h2>Interactions &amp; Feedback</h2>
      <div class="grid-columns">
        <article>
          <section class="dialogue" data-component="dialogue" aria-label="Dialogue choices">
            <header class="dialogue__header">
              <h2>Speaker: Archivist Nyra</h2>
              <div class="dialogue__hints" aria-hidden="true">
                <span class="tag">A â–¸ Select</span>
                <span class="tag">B â–¸ Back</span>
              </div>
            </header>
            <p class="dialogue__line">"Knowledge is a flame. How will you tend it, traveler?"</p>
            <ul class="dialogue__choices" role="listbox">
              <li role="option" tabindex="0" aria-selected="true">"I seek the Ember Codex."</li>
              <li role="option" tabindex="-1">"Teach me the old wards."</li>
              <li role="option" tabindex="-1">"Just passing through."</li>
            </ul>
          </section>
        </article>
        <article>
          <section class="toast-region" aria-live="polite" aria-atomic="false">
            <button class="btn" data-toast-trigger="quest">Trigger Quest Toast</button>
            <div class="toast-stack" role="status"></div>
          </section>
        </article>
        <article>
          <section class="modal-demo" aria-label="Modal demo">
            <button class="btn" data-modal-open="options">Open Options Modal</button>
            <div class="modal" data-modal="options" role="dialog" aria-modal="true" aria-labelledby="modal-options-title" hidden>
              <div class="modal__backdrop" data-modal-close></div>
              <div class="modal__dialog" role="document">
                <header class="modal__header">
                  <h2 id="modal-options-title">Options</h2>
                  <button class="btn btn-ghost" data-modal-close aria-label="Close options">âœ•</button>
                </header>
                <div class="modal__body">
                  <label>
                    <span>Text Size</span>
                    <input type="range" min="80" max="150" value="100" />
                  </label>
                  <label>
                    <span>Reduced Motion</span>
                    <input type="checkbox" />
                  </label>
                </div>
                <footer class="modal__footer">
                  <button class="btn btn-subtle" data-modal-close>Cancel</button>
                  <button class="btn">Save</button>
                </footer>
              </div>
            </div>
          </section>
        </article>
        <article>
          <section class="achievement-demo" aria-label="Achievement preview">
            <button class="btn" data-achievement-trigger>Unlock Achievement</button>
            <div class="achievement" role="status" aria-live="assertive" hidden>
              <div class="achievement__badge gold-border-shimmer">
                <span class="achievement__icon" aria-hidden="true">â˜…</span>
              </div>
              <div class="achievement__details">
                <h3>Emberlight Ascendant</h3>
                <p>Reach faction rank Exalted with the Ember Court.</p>
              </div>
            </div>
          </section>
        </article>
      </div>
    </section>

    <section>
      <h2>Background Gallery</h2>
      <div class="background-selector" role="group" aria-label="Background selector">
        <button data-bg="castle" aria-pressed="false">Castle Study</button>
        <button data-bg="forest" aria-pressed="false">Forest Glade</button>
        <button data-bg="dungeon" aria-pressed="false">Dungeon Stone</button>
        <button data-bg="library" aria-pressed="false">Arcane Library</button>
        <button data-bg="desert" aria-pressed="false">Desert Ruin</button>
        <button data-bg="snow" aria-pressed="false">Snowbound Pass</button>
      </div>
      <div class="background-preview">
        <div class="background-preview__hero" role="img" aria-live="polite" aria-label="Castle study hero background"></div>
        <div class="grid-columns">
          <div class="background-preview__layer" data-layer="bg" role="img" aria-label="Castle parallax background layer"></div>
          <div class="background-preview__layer" data-layer="fg" role="img" aria-label="Castle parallax foreground layer"></div>
        </div>
      </div>
    </section>

    <section>
      <h2>Icon Preview</h2>
      <div class="card">
        <div class="grid-columns" id="icon-grid" aria-label="Icon list"></div>
      </div>
    </section>

    <section>
      <h2>Audio Sampler</h2>
      <div class="card audio-controls">
        <button class="btn" data-play-audio="click">Click</button>
        <button class="btn" data-play-audio="confirm">Confirm</button>
        <button class="btn" data-play-audio="error">Error</button>
        <button class="btn" data-play-audio="achievement">Achievement</button>
        <button class="btn" data-play-audio="page">Page Turn</button>
        <button class="btn" data-play-audio="quest">Quest Update</button>
      </div>
    </section>
  </main>

  <footer class="page-footer">Crafted for high fantasy adventures. MIT Licensed.</footer>

  <script src="components/audio.js"></script>
  <script src="components/AppShell.js" defer></script>
  <script src="components/Button.js" defer></script>
  <script src="components/InputPack.js" defer></script>
  <script src="components/Tabs.js" defer></script>
  <script src="components/Accordion.js" defer></script>
  <script src="components/Toast.js" defer></script>
  <script src="components/Modal.js" defer></script>
  <script src="components/DialogueChoice.js" defer></script>
  <script src="components/QuestTracker.js" defer></script>
  <script src="components/CharacterSheet.js" defer></script>
  <script src="components/CombatHUD.js" defer></script>
  <script src="components/MinimapBanner.js" defer></script>
  <script src="components/Achievement.js" defer></script>
  <script src="components/MenuSystem.js" defer></script>
  <script>
    const iconList = [
      'strength','dexterity','constitution','intelligence','wisdom','charisma',
      'athletics','acrobatics','stealth','perception','survival','arcana','persuasion','intimidation','medicine','history',
      'sword','axe','bow','staff','shield','potion','scroll','coin','lockpick','backpack',
      'menu','map','quest','journal','dialogue','settings','audio','play','pause','stop','back','close','check','warning',
      'crown','mask','eye','flame','bleed','poison','burn','stun','slow'
    ];

    const iconGrid = document.getElementById('icon-grid');
    iconList.forEach((id) => {
      const figure = document.createElement('figure');
      figure.style.display = 'flex';
      figure.style.flexDirection = 'column';
      figure.style.alignItems = 'center';
      figure.style.gap = '8px';
      figure.innerHTML = `<svg width="32" height="32"><use href="icons.svg#icon-${id}"></use></svg><figcaption style="font-size:0.75rem;letter-spacing:0.08em;text-transform:uppercase;">${id}</figcaption>`;
      iconGrid.appendChild(figure);
    });

    document.querySelectorAll('[data-theme-set]').forEach((button) => {
      button.addEventListener('click', () => {
        document.documentElement.setAttribute('data-theme', button.dataset.themeSet);
      });
    });

    let reducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
    document.querySelector('[data-reduced-motion]')?.addEventListener('click', () => {
      reducedMotion = !reducedMotion;
      document.documentElement.style.setProperty('--motion-disabled', String(reducedMotion));
      if (reducedMotion) {
        document.documentElement.classList.add('prefers-reduced-motion');
      } else {
        document.documentElement.classList.remove('prefers-reduced-motion');
      }
    });

    document.querySelectorAll('[data-play-audio]').forEach((btn) => {
      btn.addEventListener('click', () => {
        window.DDAudio?.play(btn.dataset.playAudio);
      });
    });

    const volumeSlider = document.querySelector('[data-audio-volume]');
    const audioToggle = document.querySelector('[data-audio-toggle]');

    volumeSlider?.addEventListener('input', () => window.DDAudio?.setVolume(parseFloat(volumeSlider.value)));

    audioToggle?.addEventListener('click', () => {
      const muted = window.DDAudio?.toggleMute();
      if (audioToggle) audioToggle.textContent = muted ? 'Unmute Audio' : 'Mute Audio';
    });

    const backgroundButtons = document.querySelectorAll('[data-bg]');
    const heroPreview = document.querySelector('.background-preview__hero');
    const layerNodes = Array.from(document.querySelectorAll('.background-preview__layer'));
    const menuBackdrop = document.querySelector('.menu-system__background');
    let currentBackground = 'castle';
    let backgroundPresets = {
      castle: {
        title: 'Castle Study',
        hero: [
          'radial-gradient(circle at 18% 22%, rgba(200,162,74,0.32), transparent 60%)',
          'radial-gradient(circle at 78% 12%, rgba(62,165,227,0.18), transparent 58%)',
          'linear-gradient(180deg, rgba(14,15,19,0.94), rgba(32,35,43,0.76))',
          'repeating-linear-gradient(45deg, rgba(233,225,207,0.06) 0 18px, transparent 18px 36px)'
        ],
        parallax: [
          [
            'linear-gradient(180deg, rgba(14,15,19,0.82), rgba(32,35,43,0.62))',
            'radial-gradient(circle at 82% 18%, rgba(141,107,209,0.28), transparent 68%)'
          ],
          [
            'radial-gradient(circle at 32% 74%, rgba(200,162,74,0.42), transparent 56%)',
            'linear-gradient(210deg, rgba(179,58,58,0.38), transparent)'
          ]
        ],
        tile: [
          'repeating-linear-gradient(90deg, rgba(233,225,207,0.12) 0 22px, transparent 22px 44px)',
          'repeating-linear-gradient(0deg, rgba(14,15,19,0.24) 0 12px, transparent 12px 24px)',
          'radial-gradient(circle at 16% 18%, rgba(200,162,74,0.16), transparent 46%)'
        ]
      }
    };

    function joinLayers(layers = []) {
      return layers.join(',');
    }

    function applyBackground(slug) {
      const preset = backgroundPresets[slug];
      if (!preset) return;
      currentBackground = slug;
      backgroundButtons.forEach((btn) => {
        const active = btn.dataset.bg === slug;
        btn.setAttribute('aria-pressed', active ? 'true' : 'false');
      });
      document.documentElement.style.setProperty('--hero-background', joinLayers(preset.hero));
      document.documentElement.style.setProperty('--page-tile', joinLayers(preset.tile));
      if (heroPreview) {
        heroPreview.style.setProperty('background-image', joinLayers(preset.hero));
        heroPreview.setAttribute('aria-label', `${preset.title} hero background`);
      }
      layerNodes.forEach((layer, index) => {
        const layerSet = preset.parallax?.[index] ?? preset.hero;
        layer.style.setProperty('background-image', joinLayers(layerSet));
        layer.setAttribute('aria-label', `${preset.title} parallax layer ${index + 1}`);
      });
      if (menuBackdrop) {
        menuBackdrop.style.setProperty('background-image', joinLayers(preset.parallax?.[0] ?? preset.hero));
        menuBackdrop.setAttribute('aria-label', `${preset.title} backdrop`);
      }
    }

    fetch('backgrounds/presets.json')
      .then((response) => (response.ok ? response.json() : {}))
      .then((json) => {
        backgroundPresets = { ...backgroundPresets, ...json };
        applyBackground(currentBackground);
      })
      .catch(() => {
        applyBackground(currentBackground);
      });

    backgroundButtons.forEach((btn) => {
      btn.addEventListener('click', () => {
        const slug = btn.dataset.bg;
        if (!slug) return;
        if (!backgroundPresets[slug]) return;
        applyBackground(slug);
      });
    });

    applyBackground(currentBackground);

    document.addEventListener('DOMContentLoaded', () => {
      if (volumeSlider) {
        window.DDAudio?.setVolume(parseFloat(volumeSlider.value));
      }
      document.dispatchEvent(new CustomEvent('dd:hydrate'));
    });
  </script>
</body>
</html>
